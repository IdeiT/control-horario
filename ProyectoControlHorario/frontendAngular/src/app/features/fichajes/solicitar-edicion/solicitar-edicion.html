<mat-toolbar color="primary">
  <button mat-icon-button routerLink="/fichajes/historial">
    <mat-icon>arrow_back</mat-icon>
  </button>
  <span>‚úèÔ∏è Solicitar Edici√≥n</span>
</mat-toolbar>

<div class="solicitud-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Solicitar Edici√≥n de Fichaje</mat-card-title>
      <mat-card-subtitle>Solicita modificar un fichaje existente</mat-card-subtitle>
    </mat-card-header>
    
    <mat-card-content>
      <!-- Mostrar el fichaje seleccionado -->
      <div *ngIf="fichajeSeleccionado && !loadingFichaje" class="fichaje-seleccionado">
        <mat-icon class="fichaje-icon">assignment</mat-icon>
        <div class="fichaje-info">
          <div class="fichaje-label">Fichaje seleccionado:</div>
          <div class="fichaje-texto">{{ getInstanteActual() }} ({{ getTipoActual() }})</div>
        </div>
      </div>

      <div *ngIf="loadingFichaje" style="text-align: center; padding: 20px;">
        <mat-spinner diameter="40"></mat-spinner>
        <p style="margin-top: 10px; color: #666;">Cargando fichaje...</p>
      </div>

      <form [formGroup]="solicitudForm" (ngSubmit)="onSubmit()" *ngIf="fichajeSeleccionado && !loadingFichaje">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nuevo Instante (Fecha y Hora)</mat-label>
          <input matInput type="datetime-local" formControlName="nuevoFechaHora">
          <mat-hint>‚ÑπÔ∏è Ingresa la fecha y hora en tu zona horaria local</mat-hint>
          <mat-error *ngIf="solicitudForm.get('nuevoFechaHora')?.hasError('required')">
            La fecha y hora son requeridas
          </mat-error>
        </mat-form-field>

        <button mat-raised-button color="primary" type="submit" class="full-width" 
                [disabled]="loading || solicitudForm.invalid">
          <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
          {{ loading ? 'Enviando...' : 'üì§ Enviar Solicitud' }}
        </button>

        <div *ngIf="message" class="message" [class.success]="messageType === 'success'" [class.error]="messageType === 'error'">
          {{ message }}
        </div>
      </form>

      <div class="info-box">
        <strong>‚ö†Ô∏è Importante:</strong>
        <ul>
          <li>Tu solicitud ser√° enviada a un supervisor de tu departamento</li>
          <li>El supervisor debe aprobar la modificaci√≥n antes de que se aplique</li>
          <li>Puedes verificar el estado en "Ver Fichajes" (En tr√°mite / Aprobada)</li>
        </ul>
      </div>
    </mat-card-content>
  </mat-card>
</div>
